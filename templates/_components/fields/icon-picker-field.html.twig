{{ attach_library('vactory_dashboard/alpine-icon-picker') }}

<div class="icon-picker-field"
     x-data="iconPickerGrid('{{ x_model }}')"
     x-init="init()"
>
    <div class="flex items-center gap-2 mb-2">
        <div class="w-16 h-16 border border-gray-300 rounded flex items-center justify-center bg-white">
            <template x-if="selectedIcon && isSvgProvider">
                <span class="text-gray-700" x-html="getSvgHtml(selectedIcon, 32)"></span>
            </template>
            <template x-if="selectedIcon && !isSvgProvider">
                <i :class="'icon-' + selectedIcon" class="text-2xl text-gray-700"></i>
            </template>
            <template x-if="!selectedIcon">
                <span style="color: #9ca3af; font-size: 12px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">{{ 'No icon'|t }}</span>
            </template>
        </div>

        <button type="button"
                @click="showPicker = !showPicker"
                class="w-10 h-10 border border-gray-300 rounded flex items-center justify-center bg-gray-50 hover:bg-gray-100 transition-colors">
            <svg x-show="!showPicker" class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
            </svg>
            <svg x-show="showPicker" class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>
    </div>

    <input type="hidden"
           x-model="{{ x_model }}"
           :required="{{ required }}"
           x-ref="hiddenInput"
           x-effect="selectedIcon = {{ x_model }} || selectedIcon">

    <div x-show="showPicker"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 transform -translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform -translate-y-2"
         class="border border-gray-300 rounded-lg bg-white shadow-lg p-4 mt-2">

        <div style="margin-bottom: 16px; position: relative; display: flex; align-items: center;">
            <svg style="position: absolute; left: 12px; width: 18px; height: 18px; color: #9ca3af;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <input type="text"
                   x-model="searchQuery"
                   @input="filterIcons()"
                   placeholder="{{ 'Search icons...'|t }}"
                   style="width: 100%; padding: 10px 12px 10px 40px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; color: #4b5563; outline: none;">
        </div>

        <div x-show="isLoading" class="flex justify-center items-center py-8">
            <svg class="animate-spin h-8 w-8 text-primary-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>

        <div x-show="hasError && !isLoading" class="text-center py-8">
            <span class="text-red-500">{{ 'Failed to load icons'|t }}</span>
            <button type="button" @click="loadIcons()" class="ml-2 text-primary-500 underline">{{ 'Retry'|t }}</button>
        </div>

        <div x-show="!isLoading && !hasError">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 8px; max-height: 300px; overflow-y: auto; padding: 4px;">
                <template x-for="icon in paginatedIcons" :key="icon.name">
                    <button type="button"
                            @click="selectIcon(icon.name)"
                            :class="{
                                'bg-primary-500 text-white border-primary-500': selectedIcon === icon.name,
                                'bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100 hover:border-gray-300': selectedIcon !== icon.name
                            }"
                            style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border: 1px solid #e5e7eb; border-radius: 6px; cursor: pointer;"
                            :title="icon.label">
                        <template x-if="isSvgProvider">
                            <span x-html="getSvgHtml(icon.name, 20)"></span>
                        </template>
                        <template x-if="!isSvgProvider">
                            <i :class="'icon-' + icon.name" style="font-size: 20px;"></i>
                        </template>
                    </button>
                </template>
            </div>

            <div x-show="filteredIcons.length === 0 && searchQuery.length > 0" style="text-align: center; padding: 16px 0; color: #6b7280; font-size: 14px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                {{ 'No icons found'|t }}
            </div>

            <div x-show="totalPages > 1" class="flex items-center justify-between mt-4 pt-3 border-t border-gray-200">
                <span class="text-sm text-gray-500">
                    <span x-text="currentPage"></span>/<span x-text="totalPages"></span>
                    (<span x-text="filteredIcons.length"></span>)
                </span>
                <div class="flex gap-1">
                    <button type="button"
                            @click="prevPage()"
                            :disabled="currentPage === 1"
                            :class="{ 'opacity-50 cursor-not-allowed': currentPage === 1 }"
                            class="p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button type="button"
                            @click="nextPage()"
                            :disabled="currentPage === totalPages"
                            :class="{ 'opacity-50 cursor-not-allowed': currentPage === totalPages }"
                            class="p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
